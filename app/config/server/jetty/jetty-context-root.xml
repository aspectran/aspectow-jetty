<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aspectran PUBLIC "-//ASPECTRAN//DTD Aspectran 9.0//EN"
        "https://aspectran.com/dtd/aspectran-9.dtd">
<aspectran>

    <description>
        Aspectran configuration for setting up the servlet context.
    </description>

    <environment>
        <property name="jetty.context.root.name">root</property>
    </environment>

    <bean id="jetty.context.root.webAppContext"
          class="com.aspectran.jetty.server.servlet.JettyWebAppContext"
          scope="prototype">
        <property name="contextPath">/</property>
        <property name="war">/webapps/%{jetty.context.root.name}</property>
        <property name="tempDirectory">/work/_webapps/%{jetty.context.root.name}</property>
        <property name="tempDirectoryPersistent" valueType="boolean">true</property>
        <property name="defaultsDescriptor">/config/server/jetty/webdefault-ee10.xml</property>
        <property name="sessionHandler">#{jetty.context.root.sessionHandler}</property>
        <property name="initParams" type="map">
            <entry name="logbackDisableServletContainerInitializer" value="true"/>
        </property>
        <property name="servlets" type="array">
            <bean class="com.aspectran.jetty.server.servlet.DefaultJspServlet">
                <property name="initOrder" valueType="int">1</property>
            </bean>
            <bean class="com.aspectran.jetty.server.servlet.JettyServlet">
                    <argument>webActivityServlet</argument>
                    <argument>com.aspectran.web.servlet.WebActivityServlet</argument>
                <property name="mappings" type="array">
                    <value>/</value>
                </property>
                <property name="initOrder" valueType="int">2</property>
            </bean>
        </property>
        <property name="servletContainerInitializers" type="array">
            <bean class="com.aspectran.jetty.server.servlet.JettyJasperInitializer">
                <property name="tldResources" type="array">
                    <value>classpath:com/aspectran/web/support/tags/aspectran.tld</value>
                    <value>/webapps/%{jetty.context.root.name}/WEB-INF/taglibs/</value>
                </property>
            </bean>
        </property>
        <property name="webSocketServerContainerInitializer">
            <bean class="com.aspectran.jetty.server.servlet.JettyWebSocketServerContainerInitializer">
                <property name="idleTimeout" valueType="long">60000</property>
            </bean>
        </property>
    </bean>

    <bean id="jetty.context.root.sessionHandler"
          class="com.aspectran.jetty.server.session.JettySessionHandler"
          scope="prototype">
        <property name="sessionDataStore">
            <bean class="com.aspectran.jetty.server.session.JettyFileSessionDataStoreFactory">
                <property name="storeDir">/work/_sessions/%{jetty.context.root.name}</property>
                <property name="deleteUnrestorableFiles" valueType="boolean">true</property>
            </bean>
        </property>
    </bean>

</aspectran>
